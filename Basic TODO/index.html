<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TIWP - lab 7</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        body
        {
            font-family: Verdana, Arial, sans-serif;
            font-size: 15px;
        }

        h2
        {
            font-size: 40px;
            margin: 5px;
            margin-top: 20px;
        }

        .item
        {
            margin: 3px;
            padding: 10px;
            font-size: 1.4em;
            height: 18px;
        }
        .list
        {
            float: left;
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: 10px;
            margin-right: 10px;
            padding: 20px;
        }

        .list .ui-button
        {
            float: right;
        }

        input
        {
            font-size: 21px;
        }

    </style>
</head>
<body>
    <h2>To Do</h2>
    <form name="checkListForm">
        <input type="text" name="checkListItem" class="textEdit">
    </form>
    <div id="button" class="ui-button">Dodaj</div>
    <br>
    <div class="list"></div>

    <script type="text/javascript">
        $(document).ready(function (){

            //sortowanie
            $(function() {
                $(".list").sortable();
                $(".list").disableSelection();
            });

            //okno edycji danych
            $("#dialog").dialog({
                title: "Edycja danych:",
                resizable: false,
                autoOpen: false,
                modal: true,
                close: function ()
                {
                    $("input[name=checkListItemEdit]").val("");
                }
            });

            //dodawanie
            $("#button").click(function (){
                var toAdd = $("input[name=checkListItem]").val();
                if(toAdd != null && toAdd != "")
                {
                    $(".list").append('<div class="item ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><input type="checkbox"><span class="itemText">' + toAdd + '</span><button class="ui-button deleteButton">Usuń</button><button class="ui-button editButton">Edytuj</button></div>');
                    $("input[name=checkListItem]").val("");
                }
            })

            //usuwanie
            $(document).on('click', '.deleteButton', function (){
                $(this).parent().remove();
            })

            //edycja
            $(document).on('click', '.editButton', function (){

                //usunięcie poprzedniej funkcji z przycisku okna edycji danych
                $("#buttonSave").unbind("click");

                var tmp = this;

                $("input[name=checkListItemEdit]").val( $(this).parent().children(".itemText").text() );

                //nowa funkcja przycisku okna edycji danych (odnosząca się do aktualnie edytowanego elementu)
                $("#buttonSave").click( function (){
                    $(tmp).parent().children(".itemText").text( $("input[name=checkListItemEdit]").val() );
                    $("input[name=checkListItemEdit]").val("");
                    $("#dialog").dialog("close");
                })

                $("#dialog").dialog("open");

                $("#dialog").children(".textEdit").val( $(this).parent().children(".itemText").text() );
            })

            //zaznaczenie/odznaczenie checkboxa danego elementu
            $(document).on('change', 'input[type="checkbox"]', function (){
                if(this.checked)
                {
                    $(this).parent().css('background', 'green');
                    $(this).parent().css('color', 'white');
                    $(this).parent().css('text-decoration', 'line-through');
                }
                else
                {
                    $(this).parent().css('background', 'initial');
                    $(this).parent().css('color', 'initial');
                    $(this).parent().css('text-decoration', 'initial');
                }
            })
        })
    </script>
    <div id="dialog">
        <form name="checkListForm">
            <input type="text" name="checkListItemEdit" class="textEdit">
        </form>
        <div id="buttonSave" class="ui-button">Zapisz</div>
    </div>
</body>
</html>